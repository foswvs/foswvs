<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<title>rates</title>
<link href="/css/pico.min.css" rel="stylesheet">
<style>
figure, table {
  margin-bottom: 0;
}
td, th {
  white-space: nowrap;
  padding-left: 0;
  padding-right: 4px;
}
td {
  border: 0;
  padding-top: 0;
  padding-bottom: 0;
}
td:nth-child(3) {
  padding-right: 0;
}
tbody tr:nth-child(1) td {
  padding-top: 1em;
}
th:nth-child(1) {
  width: 20%;
}
th:nth-child(2) {
  width: 32%;
}
</style>
</head>
<body>
<main class="container">
  <form action="rates.php" method="POST">
    <figure>
      <table id="rates">
        <thead>
          <tr><th>Amount</th><th>MB Size</th><th>Amount/Unit</th></tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </figure>
  </form>
</main>
<script src="/js/theme.js"></script>
<script src="/js/a.js"></script>
<script>
fetch('./rates.php').then((r)=>r.json()).then((r)=> {
  let tb = document.getElementById('rates').getElementsByTagName('tbody')[0];

  for(k in r) {
    let tr = tb.insertRow(-1),
        c0 = tr.insertCell(0),
        c1 = tr.insertCell(1),
        c2 = tr.insertCell(2);

    let r_amt = document.createElement('input');
    let r_val = document.createElement('input');
    let r_dis = document.createElement('input');

    r_amt.type ='text';
    r_amt.value = k;

    r_val.type ='text';
    r_val.name =`rates[${k}]`;
    r_val.value = r[k];

    r_dis.disabled = true;
    r_dis.type = 'text';
    r_dis.value = peso.format(k) + ' / ' + format_mb(r[k]);

    c0.appendChild(r_amt);
    c1.appendChild(r_val);
    c2.appendChild(r_dis);

    r_amt.addEventListener('keyup', (e) => {
      if ( e.keyCode === 65 ) {
        let clonedRow = r_amt.parentNode.parentNode.cloneNode(true);
        console.log(clonedRow);
        tb.appendChild(clonedRow);
      }

      if ( e.keyCode === 68 ) {
        let rowIndex = r_amt.parentNode.parentNode.sectionRowIndex;
        tb.deleteRow(rowIndex);
      }

      let n = parseInt(r_amt.value) || 0;

      if( n > 1000 ) n = 1000;

      r_val.name =`rates[${n}]`;

      r_amt.value = n;

    });

    r_val.addEventListener('keyup', () => {
      let n = parseInt(r_val.value) || 0;

      if( n > 1e8 ) n = 1e8;

      r_dis.value = peso.format(r_amt.value) + ' = ' + format_mb(n);

      r_val.name =`rates[${r_amt.value}]`;
      r_val.value = n;
    });

    r_amt.addEventListener('click',(e)=>e.target.select());
    r_val.addEventListener('click',(e)=>e.target.select());

  }

  let b = document.createElement('button');
  b.innerText='update';
  b.name ='submit';
  b.type ='submit';

  let c = document.createElement('button');
  c.className='secondary';
  c.innerText='cancel';
  c.type ='button';
  c.addEventListener('click',()=>location.assign('/a/view.html'));

  let f = document.getElementsByTagName('form')[0];

  f.appendChild(b); f.appendChild(c);
});
</script>
</body>
</html>
